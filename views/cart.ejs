<!DOCTYPE html>
<html lang="en">
<head>

    <%-include ('partials/header.ejs') %>

</head>
<body>

<%-include ('partials/nav.ejs') %>
<div class="container py-4">
   <%if(items.length === 0){ %>
    <p class="alert alert-danger text-center fs-4"> There is no items</p>
   <%}else{ %>
    <div class="card shadow-sm border-0">
        <div class="card-header bg-dark text-white fw-bold">
            Shopping Cart
        </div>
        <div class="table-responsive">
            <table border="1" class="table align-middle table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th>no</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Amount</th>
                    <th>Total</th>
                </tr>
                </thead >
                <tbody>
                    <%items.forEach((item ,index) =>{ %>
                        <%const itemErrors = validationError.filter(error => error.cartId === item._id.toString() )%>
                        <tr>
                            <td class="fw-bold"><%= index+1 %></td>
                            <td><%= item.name %></td>
                            <td><%= item.price %>$ </td>
                            <form method="post">
                                <td style="width:130px;"> <input type="number" min="1" name="amount" class="form-control" value="<%=item.amount%>"></td>

                                <td class="fw-semibold"><%=  item.price * item.amount   %>$</td>
                                
                                
                                <input type="hidden" name="cartId" value="<%=item._id%>" >                        
                                <td class="text-end">
                                <input type="submit" value="Save"   class="btn btn-success" formaction="/cart/save">
                                <input type="submit" value="Order"   class="btn btn-primary" formaction="/cart/verify-orders">
                                <input type="submit" value="Delete" class="btn btn-danger" formaction="/cart/delete">
                                </td>
                            </form>

                            <tr>
                                <td colspan="6">
                                    <%itemErrors.forEach(err =>{%>
                                    <p class="alert alert-danger my-2 py-2"> <%= err.msg %></p>
                                    <%})%>
                                </td>
                            </tr>



                        </tr>


                <% }) %>
                

                </tbody>
            </table>
    </div>





<div class="container ">
    <form method="post">
        <input type="hidden" name="userId" value="<%= UserId %>" >
        
         <input type="submit" value="Order All"   class="btn btn-primary btn-lg px-4" formaction="/cart/verify-all-orders">
         <input type="submit" value="Delete All" class="btn btn-danger btn-lg px-4 ms-2" formaction="/cart/deleteAll">

    </form>


</div>
</div>
   <%}%>
</div>   
</body>


<%-include ('partials/footer.ejs') %>

</html>